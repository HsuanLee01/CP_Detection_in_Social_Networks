---
title: "Real-Life Data Analysis"
author: "Hsuan Lee"
output: pdf_document
---

```{r}
library(remstats) # the formula for REH
library(relevent) # fit REH to REM
library(REHdynamics) # fit the moving window REM
library(ocp) # package for BOCD
library(changepoint) # package for PELT, BS
library(tidyverse)
library(patchwork) # combine many plots into one
library(cowplot)
library(RColorBrewer) # colors for the plot
set.seed(9252568)
```

# Load the data

```{r}
# Load data using load():
load("RealLife_Data/Merged_ALL_parts_Apollo.rdata")

# change the name of dataset, only leave time and actors infomation
Apollo.13 <- Merged_ALL_parts_Apollo[, -c(4,5)]

# change the names of columns
colnames(Apollo.13) <- c("time", "actor1", "actor2")
```

# Fit the REM

## Step 1: Assign the formula that indicates which effects shoould contain in the model
```{r}
formula <- ~ 1 + 
  remstats::inertia(scaling = "std") +
  remstats::outdegreeSender(scaling= "std") +
  remstats::indegreeReceiver(scaling = "std") +
  remstats::totaldegreeSender(scaling = "std") +
  remstats::psABBA(consider_type = FALSE) +
  remstats::psABXA(consider_type = FALSE) +
  remstats::psABBY(consider_type = FALSE)

covar <- data.frame(id = 1:19, time = 0)
```

## Step 2: Compute the statistics
```{r}
out <- remstats(tie_effects = formula, edgelist = Apollo.13, actors = 19)
stat <- out[["statistics"]] # extract the statistics from the list
```

## Step 3: Fit the windows on the REH

Compute the optimal lengths of the windows (data-driven MW) -> *Problemtic*
```{r}
# obtain data-driven window widths
#ddwin <- ddwindows(edgelist = Apollo.13, tie_effects = formula, mintime = 1000, 
#                   covar = covar)
```

Save the DDMW, as it takes long time to run (15 hours) -> *Problemtic*
```{r}
#saveRDS(object = ddwin, file = "Apollo.13_ddwin.RDS")
```

Read the DDMW file -> *Problemtic*
```{r}
#ddmw <- readRDS("Apollo.13_ddwin.RDS")
```

Fit the REM by windows -> *Problemtic*
```{r}
# fits a moving window relational event model
#model_ddwin <- MWrem(windows = ddmw$windows, edgelist = Apollo.13, 
#		                 stats = stat, actors = covar$id, directed = TRUE)
```

-----------------
Fit the fix MWREM
```{r}
# changepoint 201321 second
# 602-604 window or -> 9-11 window

# maximum time point of each iteration of REH
tau <- max(Apollo.13$time)

# specify the length of the window
windows <- REHdynamics::createwindows(1000, tau, overlap = 2/3)

# fit to the REM model
model_fixwin <- REHdynamics::MWrem(windows, edgelist = Apollo.13, 
                                   stats = stat,
                                   actors = covar$id, directed = TRUE, 
                                   method = "MLE", model = "tie", ncores = 2)
```

Extract the window given parameters
```{r}
# extract the parameters
fixmw_ine_param <- 1
for (i in 593:length(model_fixwin)) {
  fixmw_ine_param[i] <- model_fixwin[[i]][["coefficients"]][["inertia"]]
}
```

```{r}
# extract the parameters
fixmw_out_param <- 1
for (i in 593:length(model_fixwin)) {
  fixmw_out_param[i] <- model_fixwin[[i]][["coefficients"]][["outdegreeSender"]]
}
```

```{r}
# extract the parameters
fixmw_indeg_param <- 1
for (i in 593:length(model_fixwin)) {
  fixmw_indeg_param[i] <- model_fixwin[[i]][["coefficients"]][["indegreeReceiver"]]
}
```

```{r}
# extract the parameters
fixmw_totSend_param <- 1
for (i in 593:length(model_fixwin)) {
  fixmw_totSend_param[i] <- model_fixwin[[i]][["coefficients"]][["totaldegreeSender"]]
}
```

```{r}
# extract the parameters
fixmw_psABBA_param <- 1
for (i in 593:length(model_fixwin)) {
  fixmw_psABBA_param[i] <- model_fixwin[[i]][["coefficients"]][["psABBA"]]
}
```

```{r}
# extract the parameters
fixmw_psABXA_param <- 1
for (i in 593:length(model_fixwin)) {
  fixmw_psABXA_param[i] <- model_fixwin[[i]][["coefficients"]][["psABXA"]]
}
```

```{r}
# extract the parameters
fixmw_psABBY_param <- 1
for (i in 593:length(model_fixwin)) {
  fixmw_psABBY_param[i] <- model_fixwin[[i]][["coefficients"]][["psABBY"]]
}
```

Operate chnagepoint detection methods to detect the chagepoint

- BS

```{r}
BS_fixmw_ine <- cpt.meanvar(fixmw_ine_param[593:length(model_fixwin)], method="BinSeg")

locat_BS_ine <- BS_fixmw_ine@cpts[-length(BS_fixmw_ine@cpts)]

locat_BS_ine + 593
```

```{r}
BS_fixmw_out <- cpt.meanvar(fixmw_out_param[593:length(model_fixwin)], method="BinSeg")

locat_BS_out <- BS_fixmw_out@cpts[-length(BS_fixmw_out@cpts)]

locat_BS_out + 593
```

```{r}
BS_fixmw_indeg <- cpt.meanvar(fixmw_indeg_param[593:length(model_fixwin)], method="BinSeg")

locat_BS_indeg <- BS_fixmw_indeg@cpts[-length(BS_fixmw_indeg@cpts)]

locat_BS_indeg + 593
```

```{r}
BS_fixmw_totSend <- cpt.meanvar(fixmw_totSend_param[593:length(model_fixwin)], method="BinSeg")

locat_BS_totSend <- BS_fixmw_totSend@cpts[-length(BS_fixmw_totSend@cpts)]

locat_BS_totSend + 593
```

```{r}
BS_fixmw_psABBA <- cpt.meanvar(fixmw_psABBA_param[593:length(model_fixwin)], method="BinSeg")

locat_BS_psABBA <- BS_fixmw_psABBA@cpts[-length(BS_fixmw_psABBA@cpts)]

locat_BS_psABBA + 593
```

```{r}
BS_fixmw_psABXA <- cpt.meanvar(fixmw_psABXA_param[593:length(model_fixwin)], method="BinSeg")

locat_BS_psABXA <- BS_fixmw_psABXA@cpts[-length(BS_fixmw_psABXA@cpts)]

locat_BS_psABXA + 593
```

```{r}
BS_fixmw_psABBY <- cpt.meanvar(fixmw_psABBY_param[593:length(model_fixwin)], method="BinSeg")

locat_BS_psABBY <- BS_fixmw_psABBY@cpts[-length(BS_fixmw_psABBY@cpts)]

locat_BS_psABBY + 593
```

- PELT

```{r}
PELT_fixmw_ine <- cpt.meanvar(fixmw_ine_param[593:length(model_fixwin)], method="PELT")

locat_PELT_ine <- PELT_fixmw_ine@cpts[-length(PELT_fixmw_ine@cpts)]

locat_PELT_ine + 593
```

```{r}
PELT_fixmw_out <- cpt.meanvar(fixmw_out_param[593:length(model_fixwin)], method="PELT")

locat_PELT_out <- PELT_fixmw_out@cpts[-length(PELT_fixmw_out@cpts)]

locat_PELT_out + 593
```

```{r}
PELT_fixmw_indeg <- cpt.meanvar(fixmw_indeg_param[593:length(model_fixwin)], method="PELT")

locat_PELT_indeg <- PELT_fixmw_indeg@cpts[-length(PELT_fixmw_indeg@cpts)]

locat_PELT_indeg + 593
```

```{r}
PELT_fixmw_totSend <- cpt.meanvar(fixmw_totSend_param[593:length(model_fixwin)], method="PELT")

locat_PELT_totSend <- PELT_fixmw_totSend@cpts[-length(PELT_fixmw_totSend@cpts)]

locat_PELT_totSend + 593
```

```{r}
PELT_fixmw_psABBA <- cpt.meanvar(fixmw_psABBA_param[593:length(model_fixwin)], method="PELT")

locat_PELT_psABBA <- PELT_fixmw_psABBA@cpts[-length(PELT_fixmw_psABBA@cpts)]

locat_PELT_psABBA + 593
```

```{r}
PELT_fixmw_psABXA <- cpt.meanvar(fixmw_psABXA_param[593:length(model_fixwin)], method="PELT")

locat_PELT_psABXA <- PELT_fixmw_psABXA@cpts[-length(PELT_fixmw_psABXA@cpts)]

locat_PELT_psABXA + 593
```

```{r}
PELT_fixmw_psABBY <- cpt.meanvar(fixmw_psABBY_param[593:length(model_fixwin)], method="PELT")

locat_PELT_psABBY <- PELT_fixmw_psABBY@cpts[-length(PELT_fixmw_psABBY@cpts)]

locat_PELT_psABBY + 593
```

- BOCPD

```{r}
BOCD_fixmw_ine_param <- onlineCPD(fixmw_ine_param[593:length(model_fixwin)], 
                                            getR = T, 
                                            optionalOutputs = T, 
                                            truncRlim = 10^-4)

locat_BOCD_ine <- BOCD_fixmw_ine_param[["changepoint_lists"]][["maxCPs"]][[1]]
# remove the first value of the vector, as BOCPD function indicates the first window as CP all the time
(locat_BOCD_ine <- locat_BOCD_ine[-1])

locat_BOCD_ine +593
```

```{r}
BOCD_fixmw_out_param <- onlineCPD(fixmw_out_param[593:length(model_fixwin)], 
                                            getR = T, 
                                            optionalOutputs = T, 
                                            truncRlim = 10^-4)

locat_BOCD_out <- BOCD_fixmw_out_param[["changepoint_lists"]][["maxCPs"]][[1]]
# remove the first value of the vector, as BOCPD function indicates the first window as CP all the time
(locat_BOCD_out <- locat_BOCD_out[-1])

locat_BOCD_out + 593
```

```{r}
BOCD_fixmw_indeg_param <- onlineCPD(fixmw_indeg_param[593:length(model_fixwin)], 
                                            getR = T, 
                                            optionalOutputs = T, 
                                            truncRlim = 10^-4)

locat_BOCD_indeg <- BOCD_fixmw_indeg_param[["changepoint_lists"]][["maxCPs"]][[1]]
# remove the first value of the vector, as BOCPD function indicates the first window as CP all the time
(locat_BOCD_indeg <- locat_BOCD_indeg[-1])

locat_BOCD_indeg + 593
```

```{r}
BOCD_fixmw_totSend_param <- onlineCPD(fixmw_totSend_param[593:length(model_fixwin)], 
                                            getR = T, 
                                            optionalOutputs = T, 
                                            truncRlim = 10^-4)

locat_BOCD_totSend <- BOCD_fixmw_totSend_param[["changepoint_lists"]][["maxCPs"]][[1]]
# remove the first value of the vector, as BOCPD function indicates the first window as CP all the time
(locat_BOCD_totSend <- locat_BOCD_totSend[-1])

locat_BOCD_totSend + 593
```

```{r}
BOCD_fixmw_psABBA_param <- onlineCPD(fixmw_psABBA_param[593:length(model_fixwin)], 
                                            getR = T, 
                                            optionalOutputs = T, 
                                            truncRlim = 10^-4)

locat_BOCD_psABBA <- BOCD_fixmw_psABBA_param[["changepoint_lists"]][["maxCPs"]][[1]]
# remove the first value of the vector, as BOCPD function indicates the first window as CP all the time
(locat_BOCD_psABBA <- locat_BOCD_psABBA[-1])

locat_BOCD_psABBA + 593
```

```{r}
BOCD_fixmw_psABXA_param <- onlineCPD(fixmw_psABXA_param[593:length(model_fixwin)], 
                                            getR = T, 
                                            optionalOutputs = T, 
                                            truncRlim = 10^-4)

locat_BOCD_psABXA <- BOCD_fixmw_psABXA_param[["changepoint_lists"]][["maxCPs"]][[1]]
# remove the first value of the vector, as BOCPD function indicates the first window as CP all the time
(locat_BOCD_psABXA <- locat_BOCD_psABXA[-1])

locat_BOCD_psABXA + 593
```

```{r}
BOCD_fixmw_psABBY_param <- onlineCPD(fixmw_psABBY_param[593:length(model_fixwin)], 
                                            getR = T, 
                                            optionalOutputs = T, 
                                            truncRlim = 10^-4)

locat_BOCD_psABBY <- BOCD_fixmw_psABBY_param[["changepoint_lists"]][["maxCPs"]][[1]]
# remove the first value of the vector, as BOCPD function indicates the first window as CP all the time
(locat_BOCD_psABBY <- locat_BOCD_psABBY[-1])

locat_BOCD_psABBY + 593
```




-----------------------

# Visualization

## Extract effects' parameters

```{r}
# windows given parameters
winpar <- data.frame("window" = 1:(length(model_fixwin)-592),
                     "inertia" = fixmw_ine_param[593:length(model_fixwin)],
                     "outdegreeSender" = fixmw_out_param[593:length(model_fixwin)],
                     "indegreeReceiver" = fixmw_indeg_param[593:length(model_fixwin)],
                     "totaldegreeSender" = fixmw_totSend_param[593:length(model_fixwin)],
                     "psABBA" = fixmw_psABBA_param[593:length(model_fixwin)],
                     "psABXA" = fixmw_psABXA_param[593:length(model_fixwin)],
                     "psABBY" = fixmw_psABBY_param[593:length(model_fixwin)])
```

## Fluctuations of Effects' parameters in one plot

```{r fig.width=7.33, fig.height=2.5}
winpar_long <- winpar %>% 
  pivot_longer(cols = -window, names_to = "effect", values_to = "parameter")

ggplot(winpar_long, aes(x = window, y = parameter, color = effect)) +
  geom_point() +
  scale_color_brewer(palette = "Set1", guide = "legend") +
  labs(x = "Window", 
       y = "Parameter", 
       color = "Effect") +
  theme_bw() +
  theme(plot.title = element_text(face = "italic", family = "serif"),
        axis.text = element_text(family = "serif"),
        axis.title = element_text(family = "serif"),
        legend.position = "right",
        legend.text = element_text(family = "serif"),
        legend.title = element_text(face = "italic", family = "serif"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        #panel.border = element_blank(),
        panel.background = element_blank())
```

## Inertia

```{r fig.height=2.5, fig.width=5.5, warning=FALSE}
inertia_cpd.plot <- 
  ggplot(winpar, aes(x = window, y = inertia)) +
  geom_point(color = brewer.pal(n = 7, name = "Set1")[2]) +
  labs(title = "Inertia",
       x = "Window", 
       y = "Parameter") +
  theme_bw() +
  theme(plot.title = element_text(face = "italic", family = "serif"),
        axis.text = element_text(family = "serif"),
        axis.title = element_text(family = "serif"),
        legend.position = "right",
        legend.text = element_text(family = "serif"),
        legend.title = element_text(face = "italic", family = "serif"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  geom_vline(aes(xintercept = c(locat_BOCD_ine, 
                                rep(NA, length(winpar$window)-length(locat_BOCD_ine))), 
                 color = "BOCPD", linetype = "dashed"),
             size = 1,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_PELT_ine - 0.1,
                                rep(NA, length(winpar$window)-length(locat_PELT_ine))), 
                 color = "PELT", linetype = "dotted"), 
             size = 1.2,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_BS_ine + 0.1,
                                rep(NA, length(winpar$window)-length(locat_BS_ine))), 
                 color = "BS", linetype = "solid"), 
             size = 1,
             show.legend = TRUE) +
  scale_color_manual(values = c("#e41c1c", "#4daf4a", "#387ec1"),
                     labels = c("BOCPD", "PELT", "BS"),
                     name = "CPD",
                     breaks = c("BOCPD", "PELT", "BS")) +
  scale_linetype_manual(values=c("dashed", "dotted", "solid"), 
                        labels=c("BOCPD", "PELT", "BS"), 
                        name="CPD")

inertia_cpd.plot
```

## OutdegreeSender

```{r fig.height=2.5, fig.width=5.5, warning=FALSE}
outdegree_cpd.plot <- 
  ggplot(winpar, aes(x = window, y = outdegreeSender)) +
  geom_point(color = brewer.pal(n = 7, name = "Set1")[3]) +
  labs(title = "OutdegreeSender",
       x = "Window", 
       y = "Parameter") +
  theme_bw() +
  theme(plot.title = element_text(face = "italic", family = "serif"),
        axis.text = element_text(family = "serif"),
        axis.title = element_text(family = "serif"),
        legend.position = "right",
        legend.text = element_text(family = "serif"),
        legend.title = element_text(face = "italic", family = "serif"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  geom_vline(aes(xintercept = c(locat_BOCD_out, 
                                rep(NA, length(winpar$window)-length(locat_BOCD_out))), 
                 color = "BOCPD", linetype = "dashed"),
             size = 1,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_PELT_out - 0.1,
                                rep(NA, length(winpar$window)-length(locat_PELT_out))), 
                 color = "PELT", linetype = "dotted"), 
             size = 1.2,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_BS_out + 0.1,
                                rep(NA, length(winpar$window)-length(locat_BS_out))), 
                 color = "BS", linetype = "solid"), 
             size = 1,
             show.legend = TRUE) +
  scale_color_manual(values = c("#e41c1c", "#4daf4a", "#387ec1"),
                     labels = c("BOCPD", "PELT", "BS"),
                     name = "CPD",
                     breaks = c("BOCPD", "PELT", "BS")) +
  scale_linetype_manual(values=c("dashed", "dotted", "solid"), 
                        labels=c("BOCPD", "PELT", "BS"), 
                        name="CPD")

outdegree_cpd.plot
```

## indegreeReceiver

```{r fig.height=2.5, fig.width=5.5, warning=FALSE}
indegreeReceiver_cpd.plot <- 
  ggplot(winpar, aes(x = window, y = indegreeReceiver)) +
  geom_point(color = brewer.pal(n = 7, name = "Set1")[1]) +
  labs(title = "IndegreeReceiver",
       x = "Window", 
       y = "Parameter") +
  theme_bw() +
  theme(plot.title = element_text(face = "italic", family = "serif"),
        axis.text = element_text(family = "serif"),
        axis.title = element_text(family = "serif"),
        legend.position = "right",
        legend.text = element_text(family = "serif"),
        legend.title = element_text(face = "italic", family = "serif"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  geom_vline(aes(xintercept = c(locat_BOCD_indeg, 
                                rep(NA, length(winpar$window)-length(locat_BOCD_indeg))), 
                 color = "BOCPD", linetype = "dashed"),
             size = 1,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_PELT_indeg - 0.1,
                                rep(NA, length(winpar$window)-length(locat_PELT_indeg))), 
                 color = "PELT", linetype = "dotted"), 
             size = 1.2,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_BS_indeg + 0.1,
                                rep(NA, length(winpar$window)-length(locat_BS_indeg))), 
                 color = "BS", linetype = "solid"), 
             size = 1,
             show.legend = TRUE) +
  scale_color_manual(values = c("#e41c1c", "#4daf4a", "#387ec1"),
                     labels = c("BOCPD", "PELT", "BS"),
                     name = "CPD",
                     breaks = c("BOCPD", "PELT", "BS")) +
  scale_linetype_manual(values=c("dashed", "dotted", "solid"), 
                        labels=c("BOCPD", "PELT", "BS"), 
                        name="CPD")

indegreeReceiver_cpd.plot
```

## TotaldegreeSender

```{r fig.height=2.5, fig.width=5.5, warning=FALSE}
totSender_cpd.plot <- 
  ggplot(winpar, aes(x = window, y = totaldegreeSender)) +
  geom_point(color = brewer.pal(n = 7, name = "Set1")[7]) +
  labs(title = "TotaldegreeSender",
       x = "Window", 
       y = "Parameter") +
  theme_bw() +
  theme(plot.title = element_text(face = "italic", family = "serif"),
        axis.text = element_text(family = "serif"),
        axis.title = element_text(family = "serif"),
        legend.position = "right",
        legend.text = element_text(family = "serif"),
        legend.title = element_text(face = "italic", family = "serif"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  geom_vline(aes(xintercept = c(locat_BOCD_totSend, 
                                rep(NA, length(winpar$window)-length(locat_BOCD_totSend))), 
                 color = "BOCPD", linetype = "dashed"),
             size = 1,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_PELT_totSend - 0.1,
                                rep(NA, length(winpar$window)-length(locat_PELT_totSend))), 
                 color = "PELT", linetype = "dotted"), 
             size = 1.2,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_BS_totSend + 0.1,
                                rep(NA, length(winpar$window)-length(locat_BS_totSend))), 
                 color = "BS", linetype = "solid"), 
             size = 1,
             show.legend = TRUE) +
  scale_color_manual(values = c("#e41c1c", "#4daf4a", "#387ec1"),
                     labels = c("BOCPD", "PELT", "BS"),
                     name = "CPD",
                     breaks = c("BOCPD", "PELT", "BS")) +
  scale_linetype_manual(values=c("dashed", "dotted", "solid"), 
                        labels=c("BOCPD", "PELT", "BS"), 
                        name="CPD")

totSender_cpd.plot
```

## psABBA

```{r fig.height=2.5, fig.width=5.5, warning=FALSE}
psABBA_cpd.plot <- 
  ggplot(winpar, aes(x = window, y = psABBA)) +
  geom_point(color = brewer.pal(n = 7, name = "Set1")[4]) +
  labs(title = "psABBA",
       x = "Window", 
       y = "Parameter") +
  theme_bw() +
  theme(plot.title = element_text(face = "italic", family = "serif"),
        axis.text = element_text(family = "serif"),
        axis.title = element_text(family = "serif"),
        legend.position = "right",
        legend.text = element_text(family = "serif"),
        legend.title = element_text(face = "italic", family = "serif"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  geom_vline(aes(xintercept = c(locat_BOCD_psABBA, 
                                rep(NA, length(winpar$window)-length(locat_BOCD_psABBA))), 
                 color = "BOCPD", linetype = "dashed"),
             size = 1,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_PELT_psABBA - 0.1,
                                rep(NA, length(winpar$window)-length(locat_PELT_psABBA))), 
                 color = "PELT", linetype = "dotted"), 
             size = 1.2,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_BS_psABBA + 0.1,
                                rep(NA, length(winpar$window)-length(locat_BS_psABBA))), 
                 color = "BS", linetype = "solid"), 
             size = 1,
             show.legend = TRUE) +
  scale_color_manual(values = c("#e41c1c", "#4daf4a", "#387ec1"),
                     labels = c("BOCPD", "PELT", "BS"),
                     name = "CPD",
                     breaks = c("BOCPD", "PELT", "BS")) +
  scale_linetype_manual(values=c("dashed", "dotted", "solid"), 
                        labels=c("BOCPD", "PELT", "BS"), 
                        name="CPD")

psABBA_cpd.plot
```

## psABXA

```{r fig.height=2.5, fig.width=5.5, warning=FALSE}
psABXA_cpd.plot <- 
  ggplot(winpar, aes(x = window, y = psABXA)) +
  geom_point(color = "#FFD301") +
  labs(title = "psABXA",
       x = "Window", 
       y = "Parameter") +
  theme_bw() +
  theme(plot.title = element_text(face = "italic", family = "serif"),
        axis.text = element_text(family = "serif"),
        axis.title = element_text(family = "serif"),
        legend.position = "right",
        legend.text = element_text(family = "serif"),
        legend.title = element_text(face = "italic", family = "serif"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  geom_vline(aes(xintercept = c(locat_BOCD_psABXA, 
                                rep(NA, length(winpar$window)-length(locat_BOCD_psABXA))), 
                 color = "BOCPD", linetype = "dashed"),
             size = 1,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_PELT_psABXA - 0.1,
                                rep(NA, length(winpar$window)-length(locat_PELT_psABXA))), 
                 color = "PELT", linetype = "dotted"), 
             size = 1.2,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_BS_psABXA + 0.1,
                                rep(NA, length(winpar$window)-length(locat_BS_psABXA))), 
                 color = "BS", linetype = "solid"), 
             size = 1,
             show.legend = TRUE) +
  scale_color_manual(values = c("#e41c1c", "#4daf4a", "#387ec1"),
                     labels = c("BOCPD", "PELT", "BS"),
                     name = "CPD",
                     breaks = c("BOCPD", "PELT", "BS")) +
  scale_linetype_manual(values=c("dashed", "dotted", "solid"), 
                        labels=c("BOCPD", "PELT", "BS"), 
                        name="CPD")

psABXA_cpd.plot
```

## psABBY

```{r fig.height=2.5, fig.width=5.5, warning=FALSE}
psABBY_cpd.plot <- 
  ggplot(winpar, aes(x = window, y = psABBY)) +
  geom_point(color = brewer.pal(n = 7, name = "Set1")[5]) +
  labs(title = "psABBY",
       x = "Window", 
       y = "Parameter") +
  theme_bw() +
  theme(plot.title = element_text(face = "italic", family = "serif"),
        axis.text = element_text(family = "serif"),
        axis.title = element_text(family = "serif"),
        legend.position = "right",
        legend.text = element_text(family = "serif"),
        legend.title = element_text(face = "italic", family = "serif"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  geom_vline(aes(xintercept = c(locat_BOCD_psABBY, 
                                rep(NA, length(winpar$window)-length(locat_BOCD_psABBY))), 
                 color = "BOCPD", linetype = "dashed"),
             size = 1,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_PELT_psABBY - 0.1,
                                rep(NA, length(winpar$window)-length(locat_PELT_psABBY))), 
                 color = "PELT", linetype = "dotted"), 
             size = 1.2,
             show.legend = TRUE) +
  geom_vline(aes(xintercept = c(locat_BS_psABBY + 0.1,
                                rep(NA, length(winpar$window)-length(locat_BS_psABBY))), 
                 color = "BS", linetype = "solid"), 
             size = 1,
             show.legend = TRUE) +
  scale_color_manual(values = c("#e41c1c", "#4daf4a", "#387ec1"),
                     labels = c("BOCPD", "PELT", "BS"),
                     name = "CPD",
                     breaks = c("BOCPD", "PELT", "BS")) +
  scale_linetype_manual(values=c("dashed", "dotted", "solid"), 
                        labels=c("BOCPD", "PELT", "BS"), 
                        name="CPD")

psABBY_cpd.plot
```

## Combine all plots

```{r fig.height=7.5, fig.width=11, warning=FALSE}
indegreeReceiver_cpd.plot +
  inertia_cpd.plot +
  outdegree_cpd.plot + 
  psABBA_cpd.plot +
  psABBY_cpd.plot +
  psABXA_cpd.plot +
  totSender_cpd.plot +
  plot_layout(ncol = 2, widths = c(1,1)) +
  theme(legend.position = "right")
```
